<!DOCTYPE html>
<html>
<body>
<script src="https://cdn.netpie.io/microgear.js"></script>

<script>

    const APPID = "testingNetpie";
    const KEY = "Y6ynR78mqQBIlSj";
    const SECRET = "wX8up1DQXlQ413t3glkRj5ehI";
  
    const ALIAS = "DigitalOUTPUT_HTML_web";     //  ชื่อตัวเอง
    const thing1 = "NodeMCU1";                  //  ชื่อเพื่อนที่จะคุย
  
    function falling(logic){
      if(logic == 1 ){
        microgear.publish("/fall/command", "ON");
        document.getElementById('status_fall_btn').innerHTML = "Status : ON";
      }else if(logic == 0 ){
        microgear.publish("/fall/command", "OFF");
        document.getElementById('status_fall_btn').innerHTML = "Status : ON";
      }else if(logic == 2 ){
        microgear.publish("/fall/command", "RESET");
      }
    }

    function goOut(logic){
      if(logic == 1 ){
        microgear.publish("/out-of-range/command", "ON");
        document.getElementById('status_range_btn').innerHTML = "Status : ON";
      }else if(logic == 0 ){
        microgear.publish("/out-of-range/command", "OFF");
        //<p id="status_range_btn">Status : ON</p>
        document.getElementById('status_range_btn').innerHTML = "Status : OFF";
      }else if(logic == 2 ){
        microgear.publish("/out-of-range/command", "RESET");
      }
    }

    /*function Toggle() {
      var status = document.getElementById('status_range_btn').innerHTML
      if (status === "Status : ON")
        document.getElementById('status_range_btn').innerHTML = "Status : OFF";
      else  
        document.getElementById('status_range_btn').innerHTML = "Status : ON";
      console.log(status)
    }*/
    
  
    var microgear = Microgear.create({
      key: KEY,
      secret: SECRET,
      alias : ALIAS
    });
  
  
    microgear.on('message', function(topic,data) {
      if(topic == "/fall") {
        if(data=="ok"){
          document.getElementById("status_fall").innerHTML =  "Every is OKAY :)";
        }else if(data=="fall"){
          document.getElementById("status_fall").innerHTML =  "Falling!!!!!!!!!"; 
        }
      }
      else if(topic == "/range") {
        if(data=="in"){
          document.getElementById("status_fall").innerHTML =  "I can see you";
        }else if(data=="out"){
          document.getElementById("status_fall").innerHTML =  "where are youuu";
        }
      }
      else if(topic == "/board") {
        if(data=="fine"){
          document.getElementById("status_fall").innerHTML =  "use me XD";
        }else if(data=="error"){
          document.getElementById("status_fall").innerHTML =  "fix me XP";
        }
      }
    });
  
    microgear.on('connected', function() {
      microgear.setAlias(ALIAS);
      document.getElementById("connected_NETPIE").innerHTML = "Connected to NETPIE"
    });
  
    microgear.on('present', function(event) {
      console.log(event);
    });
  
    microgear.on('absent', function(event) {
      console.log(event);
    });
  
    microgear.resettoken(function(err) {
      microgear.connect(APPID);
    });
  
  </script>

</div>
  <h1 id="fall_detector"></h1>
  <p><strong id="topic">The Fall Detector</strong></p>
  <button type="button" onclick="falling(1)">Turn ON</button>
  <button type="button" onclick="falling(0)">Turn OFF</button>
  <button type="button" onclick="falling(2)">Reset</button>
  <p id="status_fall_btn">Status : ON</p>
  <p id="status_fall">Every is OKAY :)</p>
</div>
</div>
  <h1 id="out_of_range"></h1>
  <p><strong id="topic">Out of Range</strong></p>
  <button type="button" onclick="goOut(1)">Turn ON</button>
  <button type="button" onclick="goOut(0)">Turn OFF</button>
  <button type="button" onclick="goOut(2)">Reset</button>
  <p id="status_range_btn">Status : ON</p>
  <p id="status_range">I can see you</p>
</div>
</body>
</html>

